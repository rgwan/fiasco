-- vim:set ft=lua:

-- Include L4 functionality
require("L4");

-- Name space for the server program, giving access to the full 'rom' name
-- space. The server will register the name 'smap_server'.
local ns_smap_server = L4.default_loader:create_namespace({
  rom = L4.Env.names:q("rom");
  smap_server = "placeholder";
});

-- The server program, using the 'ns_smap_server' name space in writable
-- mode. The log prefix will be 'server', colored yellow.
L4.default_loader:start({ ns = ns_smap_server:rw(),
                          log = { "server", "yellow" }},
                        "rom/ex_smap-server");


-- The client program.
-- The name space for the client program is constructed inline and giving
-- access to the full 'rom' name space. The 'smap_server' name points to
-- the name that will be registered in the 'ns_smap_server' name space,
-- i.e. the client is able to find the server.
-- The log prefix will be 'client', colored green.
L4.default_loader:start({ ns = { smap_server = ns_smap_server:l("smap_server") },
                          log = { "client", "green" } },
                        "rom/ex_smap-client");
